{
  "version": 3,
  "sources": [
    "../src/TempSensor.js"
  ],
  "names": [],
  "mappings": "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",
  "file": "TempSensor.js",
  "sourcesContent": [
    "/*\n * Copyright [2015-2017] Fraunhofer Gesellschaft e.V., Institute for\n * Open Communication Systems (FOKUS)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n'use strict';\nimport ds18b20 from \"ds18b20\";\nimport logger from \"logops\";\nimport async from \"async\";\nimport util from './Util';\n\n\nclass TempSensor {\n\n    constructor(client, refreshInterval = 5000) {\n        this._client = client;\n        this._refreshInterval = refreshInterval;\n    }\n\n    get sensors() {\n        return this._sensors;\n    }\n\n    start() {\n        var that = this;\n        return new Promise((resolve, reject) => {\n            if (!that._client || typeof that._client === \"undefined\") { //TODO: Check if client is initialised\n                reject(new Error(\"lwm2m-client object not set\"));\n            }\n            else {\n                //Get sensors\n                ds18b20.sensors((error, ids) => {\n                    if (error) {\n                        reject(error);\n                    }\n                    else {\n                        if (typeof ids === \"undefined\" || ids.length === 0) {\n                            reject(new Error(\"No temperature sensor/s found!\"));\n                        }\n\n                        logger.debug(\"Found sensor/s!\", ids);\n                        this._sensors = ids;\n\n                        //For each sensor, create client object for lwm2m\n                        var index = 0;\n                        var errors = [];\n                        async.each(ids, (id, callback) => {\n                            util.createClientObject(that._client, \"/3303/\" + index)\n                                .catch(reject)\n                                .then(() => {\n                                    return util.setClientResource(that._client, \"/3303/\" + index, 5701, \"Cel\"); //Set temperature object unit\n                                })\n                                .catch((error) => {\n                                    if (error) {\n                                        errors.push(error);\n                                    }\n                                })\n                                .then((result) => {\n                                    logger.debug(\"Set unit\", result);\n                                    index++;\n                                    callback();\n                                });\n                        }, () => { //When all sensor-objects have been created\n\n                            //Initial temperature-read\n                            that._setClientTemp(that);\n                            //Start timer for updating sensor-object with temperature-values\n                            that._timer = setInterval(that._setClientTemp, that._refreshInterval, that);\n\n                            if (errors.length > 0) {\n                                reject(errors);\n                            }\n                            else {\n                                resolve();\n                            }\n                        });\n                    }\n                })\n            }\n        });\n    }\n\n    stop() {\n        if (this._timer) {\n            clearInterval(this._timer);\n        }\n    }\n\n    _setClientTemp(that) {\n        var index = 0;\n        var errors = [];\n\n        async.each(that._sensors, (id, callback) => {\n            ds18b20.temperature(id, (error, value) => {\n                if (error) {\n                    logger.error(error);\n                    errors.push(error);\n                }\n                else {\n                    logger.debug(\"Sensor '\" + id + \"': \" + value);\n                    logger.debug(\"Setting values in lwm2m-client\");\n\n                    Promise.all([\n                            util.setClientResource(that._client, \"/3303/\" + index, 5700, value)\n                        ])\n                        .then((results) => {\n                            logger.debug(\"Set values\", results);\n                            index++;\n                            callback();\n                        }, (error) => {\n                            if (error) {\n                                errors.push(error);\n                            }\n                            index++;\n                            callback();\n                        });\n                }\n            });\n        }, () => {\n            if (errors.length > 0) {\n                logger.error(\"Error/s while storing temperature!\", errors);\n            }\n        });\n    }\n}\n\nexport default TempSensor;"
  ]
}