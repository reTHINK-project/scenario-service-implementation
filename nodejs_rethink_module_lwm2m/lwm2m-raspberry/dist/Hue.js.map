{"version":3,"sources":["../src/Hue.js"],"names":[],"mappings":"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","file":"Hue.js","sourcesContent":["/*\n * Copyright [2015-2017] Fraunhofer Gesellschaft e.V., Institute for\n * Open Communication Systems (FOKUS)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n\nimport HueControl from \"philips-hue\";\nimport logger from \"logops\";\nimport async from \"async\";\nimport util from './Util';\n\nclass Hue {\n    constructor(lwm2m, bridge, username) {\n        this._lwm2m = lwm2m;\n        this._hue = new HueControl();\n        this._hue.bridge = bridge;\n        this._hue.username = username;\n    }\n\n    start() { //Get all lights and create lwm2m-objects\n        var that = this;\n        return new Promise((resolve, reject) => {\n            var lights = null;\n\n            this._hue.getLights()\n                .catch(reject)\n                .then((result) => {\n                    lights = result;\n                    return that._createObjects(lights);\n                })\n                .catch(reject)\n                .then(() => {\n                    resolve(lights)\n                })\n        });\n    }\n\n    _createObjects(lights) {\n        var that = this;\n        return new Promise((resolve, reject) => {\n            var errors = [];\n\n            async.each(Object.keys(lights), (id, callback) => {\n                that._lwm2m.registry.create(\"/3311/\" + id, (error) => {\n                    if (error) {\n                        errors.push(error);\n                    }\n                    else {\n                        logger.debug(\"Hue: Created lwm2m-object for light '\" + id + \"' '/3311/\" + id + \"'\");\n\n                        //Get initial light info and set resources\n                        //TODO\n                    }\n                    callback();\n                })\n            }, () => {\n                if (errors.length > 0) {\n                    reject(errors);\n                }\n                else {\n                    resolve();\n                }\n            }); //Resolve when all objects have been created\n        });\n    }\n\n    stop() {\n\n    }\n\n    handleWrite(objectType, objectId, resourceId, value) {\n        var that = this;\n        return new Promise((resolve, reject) => {\n            if (objectType !== \"3311\") {\n                reject(new Error(\"Invalid objectType for hue!\"));\n            }\n            else {\n                switch (resourceId) {\n                    case \"5850\": //On/off\n                        that._setOnState(objectId, value)\n                            .catch(reject)\n                            .then(resolve);\n                        break;\n                    case \"5851\": //Dimmer (0-100)\n                        if (value >= 1 && value <= 100) {\n                            var state = {};\n                            state.bri = Math.round((value * 253) / 101); //Convert from range '0-100' to '1-254' for hue api //TODO inaccurate\n                            that._hue.light(objectId).setState(state)\n                                .catch(reject)\n                                .then(() => {\n                                    logger.debug(\"Hue: Light \" + objectId + \": BRI\", state);\n                                    resolve();\n                                });\n                        }\n                        else {\n                            reject(new Error(\"Invalid value-range for brightness. Use 1-100\"));\n                        }\n                        break;\n                    case \"5706\": //Colour\n                        reject(new Error(\"Colour-control not yet supported\"));\n                        break;\n                    default:\n                        reject(new Error(\"Unknown operation for resourceId \" + resourceId));\n                        break;\n                }\n            }\n        });\n    }\n\n    _setOnState(id, state) {\n        var that = this;\n        return new Promise((resolve, reject) => {\n            var done;\n            if (state == true) {\n                done = that._hue.light(id).on();\n            }\n            else {\n                done = that._hue.light(id).off();\n            }\n            done\n                .catch(reject)\n                .then(() => {\n                    logger.debug(\"Hue: Light \" + id + \" on: \" + state);\n                    resolve();\n                });\n        });\n    }\n\n    get ctl() {\n        return this._hue;\n    }\n}\n\nexport default Hue;"]}