{
  "version": 3,
  "sources": [
    "../src/index.js"
  ],
  "names": [],
  "mappings": "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",
  "file": "index.js",
  "sourcesContent": [
    "/*\n * Copyright [2015-2017] Fraunhofer Gesellschaft e.V., Institute for\n * Open Communication Systems (FOKUS)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n'use strict';\n\n\nimport lwm2mlib from \"lwm2m-node-lib\";\nimport logger from \"logops\";\nimport cmd from \"command-node\";\nimport config from \"./../config\";\nimport TempSensor from \"./TempSensor\";\n\nlogger.format = logger.formatters.dev;\nlogger.setLevel('INFO'); //Initial log-level, overwritten by config later\n\n\nvar client = lwm2mlib.client;\nvar globalDeviceInfo = null;\nvar tempSensor = null;\n\nlogger.debug(\"Initialising from config\");\ninit(config)\n    .catch(function (error) {\n        logger.fatal(\"Error while initialising! Abort.\");\n        if (error) {\n            logger.fatal(error);\n        }\n        process.exit(1);\n    })\n    .then(function () {\n        logger.info(\"Connecting to server\");\n        register() //TODO: add timeout\n            .catch(function (error) {\n                logger.error(\"Could not connect to server!\", error);\n            })\n            .then(function () {\n                logger.info(\"Registered at server '\" + config.connection.host + \":\" + config.connection.port + \"' as '\" + config.connection.endpoint + \"'!\");\n            });\n    });\n\nfunction init(config) {\n    return new Promise(function (resolve, reject) {\n        if (!config || !config.hasOwnProperty(\"client\") || !config.hasOwnProperty(\"connection\")) {\n            reject(new Error(\"Invalid configuration! Can't start.\"));\n        }\n        else {\n            logger.setLevel(config.client.logLevel);\n            client.init(config);\n            initTempSensor(lwm2mlib.client, config.sensors.temperature.refreshInterval);\n\n            resolve();\n        }\n    });\n}\n\nfunction initTempSensor(client, refreshInterval) {\n    tempSensor = new TempSensor(client, refreshInterval);\n    tempSensor.start()\n        .catch((error) => {\n            logger.error(\"Error while starting temperature-sensor!\", error);\n        })\n        .then(() => {\n            logger.info(\"Reading temperature sensor/s\", tempSensor.sensors);\n        });\n}\n\n\nfunction execute(objectType, objectId, resourceId, value, callback) {\n    logger.debug(\"Received 'execute'\\n\" + objectType + \"/\" + objectId + \" \" + resourceId + \" \" + value);\n    cmd.prompt();\n    callback(null);\n}\n\nfunction read(objectType, objectId, resourceId, value, callback) {\n    logger.debug(\"Received 'read'\\n\" + objectType + \"/\" + objectId + \" \" + resourceId + \" \" + value);\n    cmd.prompt();\n    callback(null);\n}\n\nfunction write(objectType, objectId, resourceId, value, callback) {\n    logger.debug(\"Received 'write'\\n\" + objectType + \"/\" + objectId + \" \" + resourceId + \" \" + value);\n    cmd.prompt();\n    callback(null);\n}\n\nfunction setHandlers(deviceInfo) {\n    client.setHandler(deviceInfo.serverInfo, 'write', write);\n    client.setHandler(deviceInfo.serverInfo, 'execute', execute);\n    client.setHandler(deviceInfo.serverInfo, 'read', read);\n}\n\nfunction register() {\n    return new Promise(function (resolve, reject) {\n        if (globalDeviceInfo) {\n            reject(new Error(\"Can not register, already registered!\"));\n        }\n        else {\n            client.register(config.connection.host, config.connection.port, config.connection.url, config.connection.endpoint, function (error, deviceInfo) {\n                if (error) {\n                    reject(error);\n                }\n                else {\n                    globalDeviceInfo = deviceInfo;\n                    setHandlers(deviceInfo);\n                    resolve();\n                }\n            })\n        }\n    });\n}\n\nfunction unregister() {\n    return new Promise(function (resolve, reject) {\n        if (!globalDeviceInfo) {\n            reject(new Error(\"Can't unregister, not registered!\"));\n        }\n        else {\n            client.unregister(globalDeviceInfo, function (error) {\n                if (error) {\n                    reject(error);\n                }\n                else {\n                    globalDeviceInfo = null;\n                    resolve();\n                }\n            })\n        }\n    });\n}\n\nfunction cmd_showConfig() {\n    logger.info(config);\n}\n\nfunction cmd_stop() {\n    logger.info(\"Stopping client\");\n\n    if (tempSensor) {\n        tempSensor.stop();\n    }\n\n    unregister()\n        .catch(function (error) {\n            logger.error(\"Error while unregistering from server!\");\n            if (error) {\n                logger.error(error);\n            }\n            cmd_exit();\n        })\n        .then(function () { //TODO: Fix: Also runs on .catch above\n            logger.info(\"Unregistered from '\" + config.connection.host + \":\" + config.connection.port + \"'!\");\n            cmd_exit();\n        });\n}\n\nfunction cmd_exit() {\n    logger.info(\"Stopping cmd...\");\n    process.exit(0);\n}\n\nvar commands = {\n    'stop': {\n        parameters: [],\n        description: '\\tStop client',\n        handler: cmd_stop\n    },\n    'exit': {\n        parameters: [],\n        description: '\\tExit cmd, forces running threads to stop.',\n        handler: cmd_exit\n    },\n    'config': {\n        parameters: [],\n        description: '\\tShow current configuration',\n        handler: cmd_showConfig\n    }\n};\n\ncmd.initialize(commands, '> ');\n"
  ]
}